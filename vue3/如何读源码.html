<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>源码 | 辉月’s blog</title>
    <meta name="description" content="keep going">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/v-blog/assets/css/0.styles.4f33c379.css" as="style"><link rel="preload" href="/v-blog/assets/js/app.6eaa013e.js" as="script"><link rel="preload" href="/v-blog/assets/js/2.026a05a8.js" as="script"><link rel="preload" href="/v-blog/assets/js/17.bb5ec188.js" as="script"><link rel="prefetch" href="/v-blog/assets/js/10.42ee5576.js"><link rel="prefetch" href="/v-blog/assets/js/11.a3d76cc2.js"><link rel="prefetch" href="/v-blog/assets/js/12.898c01cf.js"><link rel="prefetch" href="/v-blog/assets/js/13.86842bbe.js"><link rel="prefetch" href="/v-blog/assets/js/14.44568f3d.js"><link rel="prefetch" href="/v-blog/assets/js/15.a53d9680.js"><link rel="prefetch" href="/v-blog/assets/js/16.d334e0f7.js"><link rel="prefetch" href="/v-blog/assets/js/18.b3f04eb1.js"><link rel="prefetch" href="/v-blog/assets/js/19.25ff4670.js"><link rel="prefetch" href="/v-blog/assets/js/20.6cfacc53.js"><link rel="prefetch" href="/v-blog/assets/js/21.885a7966.js"><link rel="prefetch" href="/v-blog/assets/js/22.37dadd78.js"><link rel="prefetch" href="/v-blog/assets/js/3.2bf3d0ec.js"><link rel="prefetch" href="/v-blog/assets/js/4.c4dd5428.js"><link rel="prefetch" href="/v-blog/assets/js/5.fcfee8eb.js"><link rel="prefetch" href="/v-blog/assets/js/6.20ab58fd.js"><link rel="prefetch" href="/v-blog/assets/js/7.41866011.js"><link rel="prefetch" href="/v-blog/assets/js/8.2c341739.js"><link rel="prefetch" href="/v-blog/assets/js/9.2a0ec2a8.js">
    <link rel="stylesheet" href="/v-blog/assets/css/0.styles.4f33c379.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v-blog/" class="home-link router-link-active"><!----> <span class="site-name">辉月’s blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/v-blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/v-blog/blog/FirstBlog.html" class="nav-link">
  前端精进
</a></div><div class="nav-item"><a href="/v-blog/vue3/" class="nav-link router-link-active">
  Vue3.0
</a></div> <a href="https://github.com/scalerone/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/v-blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/v-blog/blog/FirstBlog.html" class="nav-link">
  前端精进
</a></div><div class="nav-item"><a href="/v-blog/vue3/" class="nav-link router-link-active">
  Vue3.0
</a></div> <a href="https://github.com/scalerone/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    My GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/v-blog/vue3/" class="sidebar-link">官方资源</a></li><li><a href="/v-blog/vue3/如何读源码.html" class="active sidebar-link">源码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v-blog/vue3/如何读源码.html#优雅管理源码版本" class="sidebar-link">优雅管理源码版本</a></li><li class="sidebar-sub-header"><a href="/v-blog/vue3/如何读源码.html#编译源代码" class="sidebar-link">编译源代码</a></li><li class="sidebar-sub-header"><a href="/v-blog/vue3/如何读源码.html#helloworld" class="sidebar-link">HelloWorld</a></li><li class="sidebar-sub-header"><a href="/v-blog/vue3/如何读源码.html#浏览器中断点调试" class="sidebar-link">浏览器中断点调试</a></li><li class="sidebar-sub-header"><a href="/v-blog/vue3/如何读源码.html#怎样运行单元测试" class="sidebar-link">怎样运行单元测试</a></li><li class="sidebar-sub-header"><a href="/v-blog/vue3/如何读源码.html#代码结构" class="sidebar-link">代码结构</a></li><li class="sidebar-sub-header"><a href="/v-blog/vue3/如何读源码.html#如何运行模板解析器" class="sidebar-link">如何运行模板解析器</a></li></ul></li><li><a href="/v-blog/vue3/实战.html" class="sidebar-link">实战</a></li><li><a href="/v-blog/vue3/CompositionAPI.html" class="sidebar-link">复合API(CompositionAPI)</a></li><li><a href="/v-blog/vue3/响应式实现对比.html" class="sidebar-link">响应式实现对比</a></li><li><a href="/v-blog/vue3/虚拟Dom.html" class="sidebar-link">虚拟Dom新算法</a></li><li><a href="/v-blog/vue3/Fragment.html" class="sidebar-link">Fragment</a></li><li><a href="/v-blog/vue3/Teleport.html" class="sidebar-link">Teleport传送门</a></li><li><a href="/v-blog/vue3/Suspense.html" class="sidebar-link">Suspense</a></li><li><a href="/v-blog/vue3/TypeScript支持.html" class="sidebar-link">Typescript支持</a></li><li><a href="/v-blog/vue3/自定义渲染器.html" class="sidebar-link">自定义渲染器</a></li><li><a href="/v-blog/vue3/性能提升.html" class="sidebar-link">性能提升</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h1> <h2 id="优雅管理源码版本"><a href="#优雅管理源码版本" class="header-anchor">#</a> 优雅管理源码版本</h2> <p>为了可以在测试项目中引用vue3源码，并且在下次版本更新中可以优雅的进行升级。
我决定使用git的子模块功能来进行管理</p> <blockquote><p>git子模块介绍
https://blog.csdn.net/guotianqing/article/details/82391665</p></blockquote> <h3 id="初始化子模块"><a href="#初始化子模块" class="header-anchor">#</a> 初始化子模块</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> submodule <span class="token function">add</span> https://github.com/vuejs/vue-next source/vue-next
</code></pre></div><p>子模块内容记录在.gitmodules文件中</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 更新模块</span>
<span class="token function">git</span> submodule init
<span class="token comment"># 更新模块</span>
<span class="token function">git</span> submodule update --init --recursive
</code></pre></div><h2 id="编译源代码"><a href="#编译源代码" class="header-anchor">#</a> 编译源代码</h2> <h3 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">## 修改镜像</span>
<span class="token function">yarn</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org --global
<span class="token function">yarn</span> config <span class="token builtin class-name">set</span> disturl https://npm.taobao.org/dist --global

<span class="token comment">## 去除pupteer</span>
<span class="token comment"># 忽略下载Chromium</span>
<span class="token function">yarn</span> --ignore-scripts
</code></pre></div><h3 id="打包编译"><a href="#打包编译" class="header-anchor">#</a> 打包编译</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> dev
</code></pre></div><h2 id="helloworld"><a href="#helloworld" class="header-anchor">#</a> HelloWorld</h2> <h3 id="经典api"><a href="#经典api" class="header-anchor">#</a> 经典API</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>../../source/vue-next/packages/vue/dist/vue.global.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>app<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                &lt;button @click='click'&gt;{{message}}&lt;/button&gt;
            </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span>
                    message<span class="token operator">:</span> <span class="token string">'Hello Vue 3!!'</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            methods<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click ....'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> vm <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
        <span class="token comment">// console.log(vm)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="复合api"><a href="#复合api" class="header-anchor">#</a> 复合API</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>../../source/vue-next/packages/vue/dist/vue.global.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">const</span> <span class="token punctuation">{</span> createApp<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span>watchEffect <span class="token punctuation">}</span> <span class="token operator">=</span> Vue
        <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
            template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                &lt;button @click=&quot;click&quot;&gt;
                {{ state.message }}
                &lt;/button&gt;
            </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    message<span class="token operator">:</span><span class="token string">'Hello Vue 3!!'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'state change '</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">function</span> <span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    state<span class="token punctuation">.</span>message <span class="token operator">=</span> state<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span>
                    state<span class="token punctuation">,</span>
                    click
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h2 id="浏览器中断点调试"><a href="#浏览器中断点调试" class="header-anchor">#</a> 浏览器中断点调试</h2> <h3 id="安装依赖编译源码"><a href="#安装依赖编译源码" class="header-anchor">#</a> 安装依赖编译源码</h3> <p>直接通过浏览器就可以打开本地文件</p> <p><img src="https://user-gold-cdn.xitu.io/2019/10/14/16dc9f8926e2c428?w=790&amp;h=354&amp;f=png&amp;s=57878" alt=""></p> <p>可以试一下点击的效果
接下来如果你要debug一下源码的时候你会发现代码是经过打包的无法直接在源码上打断点调试</p> <p><img src="https://user-gold-cdn.xitu.io/2019/10/14/16dca027ea37f7a8?w=1456&amp;h=333&amp;f=png&amp;s=150088" alt=""></p> <h3 id="添加sourcemap文件"><a href="#添加sourcemap文件" class="header-anchor">#</a> 添加SourceMap文件</h3> <p>为了能在浏览器中看到源码 并能够断点调试 需要再打包后代码中添加sourcemap</p> <div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token comment"># 设置环境变量 windows</span>
 <span class="token builtin class-name">set</span> <span class="token assign-left variable">SOURCE_MAP</span><span class="token operator">=</span>true <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> dev
 <span class="token comment"># 设置环境变量 windows</span>
 <span class="token builtin class-name">export</span> <span class="token assign-left variable">SOURCE_MAP</span><span class="token operator">=</span>true <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> dev
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/10/14/16dc9fcc49517370?w=1440&amp;h=351&amp;f=png&amp;s=122648" alt=""></p> <h2 id="怎样运行单元测试"><a href="#怎样运行单元测试" class="header-anchor">#</a> 怎样运行单元测试</h2> <p>Vue3代码是基于Jest进行测试，我们先简单看看什么是Jest</p> <h3 id="jest简介"><a href="#jest简介" class="header-anchor">#</a> Jest简介</h3> <blockquote><p>Jest 是Facebook的一个专门进行Javascript单元测试的工具，适合JS、NodeJS使用，具有零配置、内置代码覆盖率、强大的Mocks等特点。</p></blockquote> <p>总之目前来讲JS界Jest是一套比较成体系的测试工具。为什么这么说呢比如拿以前的测试框架Mocha对比 他只是一个测试框架，如果你需要断言还需要专门的断言库比如assert shoud expect等等 如果需要Mock还需要住啊们的库来支持很不方便。不过Jest基本上可以一次性搞定。</p> <h3 id="目录文件名约定"><a href="#目录文件名约定" class="header-anchor">#</a> 目录文件名约定</h3> <p>Jest测试代码和逻辑代码是遵从约定优于配置（convention over configuration）其实这个也是目前编程世界普遍接受的原则。</p> <p>Jest的测试代码是基于以下约定</p> <ul><li>测试文件名要以spec结果</li> <li>测试文件后缀为js，jsx，ts，tsx</li> <li>测试文件需要放在tests/unit/目录下或者是/<strong>tests</strong>/目录下
只要满足这三个要求的测试文件，使用运行jest时就会自动执行。</li></ul> <p>其实这个规定类似于Maven对于测试代码和逻辑代码的约定只是test目录换成了__tests__</p> <p>下面我们具体看一下Vue3源码的目录结构</p> <p><img src="https://user-gold-cdn.xitu.io/2019/10/18/16dde216bed9ddbd?w=199&amp;h=294&amp;f=png&amp;s=28776" alt=""></p> <p>其实逻辑代码和测试代码对应放置还是很方便的
我们再看看另外一个reactive这个包</p> <p><img src="https://user-gold-cdn.xitu.io/2019/10/18/16dde22baf1c5819?w=245&amp;h=496&amp;f=png&amp;s=33740" alt=""></p> <h3 id="运行全量测试"><a href="#运行全量测试" class="header-anchor">#</a> 运行全量测试</h3> <p>package.json文件中已经配置好了jest
<img src="https://user-gold-cdn.xitu.io/2019/10/18/16dde241c7f33c0e?w=827&amp;h=455&amp;f=png&amp;s=97788" alt=""></p> <div class="language-js extra-class"><pre class="language-js"><code>npm run test
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/10/18/16dde24e3c7ce956?w=850&amp;h=499&amp;f=png&amp;s=145745" alt=""></p> <h3 id="覆盖率"><a href="#覆盖率" class="header-anchor">#</a> 覆盖率</h3> <p>我们增加一个参数把覆盖率跑出来</p> <div class="language-bash extra-class"><pre class="language-bash"><code>npx jest --coverage 
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dec3bc09e8653f?w=841&amp;h=222&amp;f=png&amp;s=68958" alt=""></p> <p>实际上跑覆盖率的时候是有错的 我们先不去管他
我们先解析一下这个报告怎么看，如果大家学过软件工程会知道一般从理论上讲覆盖率包括</p> <ul><li>语句覆盖</li> <li>节点覆盖</li> <li>路径覆盖</li> <li>条件组合覆盖</li></ul> <p>但是一般来讲不同框架理解不一样 在Jest这里大概是这样分解的</p> <ul><li>%stmts是语句覆盖率（statement coverage）：是不是每个语句都执行了？</li> <li>%Branch分支覆盖率（branch coverage）：是不是每个if代码块都执行了？</li> <li>%Funcs函数覆盖率（function coverage）：是不是每个函数都调用了？</li> <li>%Lines行覆盖率（line coverage）：是不是每一行都执行了？</li></ul> <h3 id="单独运行一个测试"><a href="#单独运行一个测试" class="header-anchor">#</a> 单独运行一个测试</h3> <p>比如我们看看vue的index这个测试
<img src="https://user-gold-cdn.xitu.io/2019/10/18/16dde216bed9ddbd?w=199&amp;h=294&amp;f=png&amp;s=28776" alt=""></p> <p>有两种方法进行单独测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 全局安装</span>
npm i jest <span class="token operator">-</span>g
jest index

<span class="token comment">// 或者更更简便一点</span>
npx jest index
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/10/18/16dde27cabc7c149?w=648&amp;h=211&amp;f=png&amp;s=47701" alt="">
index.spec.ts</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../src'</span>

<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should support on-the-fly template compilation'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
    template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{{ count }}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        count<span class="token operator">:</span> <span class="token number">0</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> container<span class="token punctuation">)</span>
  <span class="token comment">// 断言 </span>
  <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>声明中说为了确认模板编译可以生效，这个就是一个简单的数据绑定
最后 断言也是看了一下 count是否为 0 这个例子其实除了断言部分其实直接拷贝到第一次讲的那个html文件里面是可以运行的。</p> <h3 id="响应式reactive的单元测试"><a href="#响应式reactive的单元测试" class="header-anchor">#</a> 响应式Reactive的单元测试</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dec2a5333b3579?w=243&amp;h=376&amp;f=png&amp;s=28117" alt="">
看一下每个包对应的测试代码都放在__tests__文件件中</p> <div class="language-bash extra-class"><pre class="language-bash"><code>    npx jest reactive --coverage
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16dec2bb53c3a771?w=745&amp;h=378&amp;f=png&amp;s=87625" alt=""></p> <p>好了后面我们就可以开始向源码进军了</p> <h2 id="代码结构"><a href="#代码结构" class="header-anchor">#</a> 代码结构</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16ded54d077f98c5?w=226&amp;h=433&amp;f=png&amp;s=26613" alt="">
源码位置是在package文件件内，实际上源码主要分为两部分，编译器和运行时环境。</p> <ul><li><p>编译器</p> <ul><li><p>compiler-core 核心编译逻辑</p> <ul><li>基本类型解析</li> <li>AST</li></ul></li> <li><p>compiler-dom 针对浏览器的编译逻辑</p> <ul><li>v-html</li> <li>v-text</li> <li>v-model</li> <li>v-clock</li></ul></li></ul></li> <li><p>运行时环境</p> <ul><li><p>runtime-core 运行时核心</p> <ul><li>inject</li> <li>生命周期</li> <li>watch</li> <li>directive</li> <li>component</li></ul></li> <li><p>runtime-dom 运行时针对浏览器的逻辑</p> <ul><li>class</li> <li>style</li></ul></li> <li><p>runtime-test 测试环境仿真</p> <blockquote><p>主要为了解决单元测试问题的逻辑 在浏览器外完成测试比较方便</p></blockquote></li></ul></li> <li><p>reactivity 响应式逻辑</p></li> <li><p>template-explorer 模板解析器
可以这样运行</p></li></ul> <h2 id="如何运行模板解析器"><a href="#如何运行模板解析器" class="header-anchor">#</a> 如何运行模板解析器</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> dev template-explorer
</code></pre></div><p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16ded6023c69fbbb?w=1039&amp;h=111&amp;f=png&amp;s=35819" alt=""> <img src="https://user-gold-cdn.xitu.io/2019/10/21/16ded619a2d3bad0?w=365&amp;h=288&amp;f=png&amp;s=23800" alt="">
然后打开index.html</p> <p><img src="https://user-gold-cdn.xitu.io/2019/10/21/16ded636cf1f5387?w=1502&amp;h=445&amp;f=png&amp;s=158620" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v-blog/vue3/" class="prev router-link-active">
        官方资源
      </a></span> <span class="next"><a href="/v-blog/vue3/实战.html">
        实战
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/v-blog/assets/js/app.6eaa013e.js" defer></script><script src="/v-blog/assets/js/2.026a05a8.js" defer></script><script src="/v-blog/assets/js/17.bb5ec188.js" defer></script>
  </body>
</html>
